/* ----------------------------------------------------*/
/* ИМЯ: Афонина Софья ID пользователя: 23К0094 */
/* ДАТА: 22/09/2025 */
/* НАЗНАЧЕНИЕ ПРОГРАММЫ #1 Данная программа содержит основную программу и все */
/* необходимые функции, которые в ней вызываются, включая обработчики сигналов */
/* ИМЯ ФАЙЛА: prog1.c */
/* НАЗНАЧЕНИЕ ПРОГРАММЫ: */
/* Родительский процесс, создающий дочерний процесс */
/* и осуществляющий с ним взаимодействие через сигналы */
/* ----------------------------------------------------*/

#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <signal.h>
#include <sys/wait.h>

pid_t child_pid; /* Глобальная переменная для хранения PID дочернего процесса */

/* ----------------------------------------------------*/
/* ФУНКЦИЯ signal_handler : обработчик сигналов */
/* назначение этой функции: обработка сигнала SIGUSR1 */
/* ИСПОЛЬЗОВАНИЕ ПАРАМЕТРА: */
/* int sig - номер полученного сигнала */
/* ВЫЗЫВАЕМАЯ ФУНКЦИЯ: */
/* printf - вывод сообщения на экран */
/* ----------------------------------------------------*/
void signal_handler(int sig) {
    if (sig == SIGUSR1) {
        printf("Родительский процесс получил сигнал SIGUSR1\n");
    }
}

/* ----------------------------------------------------*/
/* ФУНКЦИЯ main : основная функция программы */
/* назначение этой функции: создание дочернего процесса */
/* и взаимодействие с ним через сигналы */
/* ИСПОЛЬЗОВАНИЕ ПАРАМЕТРА: */
/* argc - количество аргументов командной строки */
/* argv - массив аргументов командной строки */
/* ВЫЗЫВАЕМАЯ ФУНКЦИЯ: */
/* signal - установка обработчика сигналов */
/* fork - создание дочернего процесса */
/* execl - запуск внешней программы */
/* kill - отправка сигнала процессу */
/* wait - ожидание завершения дочернего процесса */
/* sleep - приостановка выполнения на указанное время */
/* printf - вывод сообщения на экран */
/* perror - вывод сообщения об ошибке */
/* ----------------------------------------------------*/
int main(int argc, char *argv[]) {
    /* Установка обработчика для сигнала SIGUSR1 */
    signal(SIGUSR1, signal_handler);

    /* Создание дочернего процесса */
    child_pid = fork();
    
    if (child_pid == 0) {
        /* Код выполняется в дочернем процессе */
        printf("Дочерний процесс: запуск программы process\n");
        execl("./process", "process", NULL);
        perror("Ошибка при запуске process");
        exit(1);
    } else if (child_pid > 0) {
        /* Код выполняется в родительском процессе */
        printf("Родительский процесс: дочерний PID = %d\n", child_pid);
        
        /* Пауза для гарантии запуска дочернего процесса */
        sleep(1);
        
        /* Отправка сигнала SIGUSR1 дочернему процессу */
        printf("Родительский процесс: отправка SIGUSR1 дочернему процессу\n");
        kill(child_pid, SIGUSR1);
        
        /* Ожидание завершения дочернего процесса */
        wait(NULL);
        printf("Родительский процесс: дочерний процесс завершен\n");
    } else {
        /* Ошибка при создании процесса */
        perror("Ошибка при создании процесса");
        exit(1);
    }
    
    return 0;
}
